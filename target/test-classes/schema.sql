DROP TABLE IF EXISTS care_task_execute_log;
DROP TABLE IF EXISTS care_task_daily;
DROP TABLE IF EXISTS care_task_template;
DROP TABLE IF EXISTS elder_family;
DROP TABLE IF EXISTS family_user;
DROP TABLE IF EXISTS elder_bed_relation;
DROP TABLE IF EXISTS elder;
DROP TABLE IF EXISTS bed;
DROP TABLE IF EXISTS room;
DROP TABLE IF EXISTS vital_sign_record;
DROP TABLE IF EXISTS vital_threshold_config;
DROP TABLE IF EXISTS visit_qrcode_check_log;
DROP TABLE IF EXISTS visit_booking;
DROP TABLE IF EXISTS payment_record;
DROP TABLE IF EXISTS reconciliation_daily;
DROP TABLE IF EXISTS bill_monthly;
DROP TABLE IF EXISTS staff_role;
DROP TABLE IF EXISTS role;
DROP TABLE IF EXISTS department;
DROP TABLE IF EXISTS org;
DROP TABLE IF EXISTS staff;
DROP TABLE IF EXISTS inventory_adjustment;
DROP TABLE IF EXISTS inventory_log;
DROP TABLE IF EXISTS inventory_batch;
DROP TABLE IF EXISTS disease_forbidden_tag_audit;
DROP TABLE IF EXISTS disease_forbidden_tag;
DROP TABLE IF EXISTS product_tag;
DROP TABLE IF EXISTS elder_disease;
DROP TABLE IF EXISTS disease;
DROP TABLE IF EXISTS product;
DROP TABLE IF EXISTS `order`;
DROP TABLE IF EXISTS order_item;
DROP TABLE IF EXISTS elder_points_account;
DROP TABLE IF EXISTS points_log;
DROP TABLE IF EXISTS billing_config;
DROP TABLE IF EXISTS billing_care_level_fee;

CREATE TABLE care_task_template (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  task_name VARCHAR(128) NOT NULL,
  frequency_per_day INT NOT NULL DEFAULT 1,
  care_level_required VARCHAR(32) DEFAULT NULL,
  enabled TINYINT NOT NULL DEFAULT 1,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE care_task_daily (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  elder_id BIGINT NOT NULL,
  bed_id BIGINT DEFAULT NULL,
  template_id BIGINT NOT NULL,
  task_date DATE NOT NULL,
  plan_time DATETIME DEFAULT NULL,
  status VARCHAR(16) NOT NULL DEFAULT 'PENDING',
  assigned_staff_id BIGINT DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE care_task_execute_log (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  task_daily_id BIGINT NOT NULL,
  elder_id BIGINT NOT NULL,
  bed_id BIGINT NOT NULL,
  staff_id BIGINT NOT NULL,
  execute_time DATETIME NOT NULL,
  bed_qr_code VARCHAR(128) NOT NULL,
  result_status TINYINT NOT NULL DEFAULT 1,
  suspicious_flag TINYINT NOT NULL DEFAULT 0,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE elder (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  elder_code VARCHAR(64) NOT NULL,
  elder_qr_code VARCHAR(128) NOT NULL,
  full_name VARCHAR(64) NOT NULL,
  id_card_no VARCHAR(32) DEFAULT NULL,
  gender TINYINT DEFAULT NULL,
  birth_date DATE DEFAULT NULL,
  phone VARCHAR(32) DEFAULT NULL,
  admission_date DATE DEFAULT NULL,
  bed_id BIGINT DEFAULT NULL,
  care_level VARCHAR(32) DEFAULT NULL,
  remark VARCHAR(255) DEFAULT NULL,
  status TINYINT NOT NULL DEFAULT 1,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE room (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  building VARCHAR(64) DEFAULT NULL,
  floor_no VARCHAR(32) DEFAULT NULL,
  room_no VARCHAR(32) NOT NULL,
  room_type VARCHAR(32) DEFAULT NULL,
  capacity INT DEFAULT NULL,
  status TINYINT DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE bed (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  room_id BIGINT NOT NULL,
  bed_no VARCHAR(32) NOT NULL,
  bed_qr_code VARCHAR(128) NOT NULL,
  status TINYINT NOT NULL DEFAULT 1,
  elder_id BIGINT DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE elder_bed_relation (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  elder_id BIGINT NOT NULL,
  bed_id BIGINT NOT NULL,
  start_date DATE NOT NULL,
  end_date DATE DEFAULT NULL,
  active_flag TINYINT NOT NULL DEFAULT 1,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE family_user (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  open_id VARCHAR(128) DEFAULT NULL,
  username VARCHAR(64) DEFAULT NULL,
  password_hash VARCHAR(255) DEFAULT NULL,
  real_name VARCHAR(64) NOT NULL,
  phone VARCHAR(32) NOT NULL,
  id_card_no VARCHAR(32) DEFAULT NULL,
  status TINYINT NOT NULL DEFAULT 1,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE elder_family (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  elder_id BIGINT NOT NULL,
  family_user_id BIGINT NOT NULL,
  relation VARCHAR(32) NOT NULL,
  is_primary TINYINT NOT NULL DEFAULT 0,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE vital_sign_record (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  elder_id BIGINT NOT NULL,
  type VARCHAR(16) NOT NULL,
  value_json VARCHAR(512) NOT NULL,
  measured_at DATETIME NOT NULL,
  recorded_by_staff_id BIGINT DEFAULT NULL,
  abnormal_flag TINYINT NOT NULL DEFAULT 0,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE vital_threshold_config (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  type VARCHAR(16) NOT NULL,
  metric_code VARCHAR(32) DEFAULT NULL,
  min_value DECIMAL(10,2) DEFAULT NULL,
  max_value DECIMAL(10,2) DEFAULT NULL,
  status TINYINT NOT NULL DEFAULT 1,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE visit_booking (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  elder_id BIGINT NOT NULL,
  family_user_id BIGINT NOT NULL,
  visit_date DATE NOT NULL,
  visit_time DATETIME NOT NULL,
  visit_time_slot VARCHAR(64) NOT NULL,
  visitor_count INT NOT NULL DEFAULT 1,
  car_plate VARCHAR(32) DEFAULT NULL,
  status TINYINT NOT NULL DEFAULT 0,
  verify_code VARCHAR(64) NOT NULL,
  visit_code VARCHAR(64) NOT NULL,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE visit_qrcode_check_log (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  booking_id BIGINT NOT NULL,
  check_time DATETIME NOT NULL,
  staff_id BIGINT NOT NULL,
  qrcode_token VARCHAR(128) NOT NULL,
  result_status TINYINT NOT NULL DEFAULT 1,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE bill_monthly (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  elder_id BIGINT NOT NULL,
  bill_month CHAR(7) NOT NULL,
  total_amount DECIMAL(10,2) NOT NULL DEFAULT 0,
  paid_amount DECIMAL(10,2) NOT NULL DEFAULT 0,
  outstanding_amount DECIMAL(10,2) NOT NULL DEFAULT 0,
  status TINYINT NOT NULL DEFAULT 0,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE payment_record (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  bill_monthly_id BIGINT NOT NULL,
  amount DECIMAL(10,2) NOT NULL,
  pay_method VARCHAR(32) NOT NULL,
  external_txn_id VARCHAR(64) DEFAULT NULL,
  paid_at DATETIME NOT NULL,
  operator_staff_id BIGINT DEFAULT NULL,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE reconciliation_daily (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  reconcile_date DATE NOT NULL,
  total_received DECIMAL(10,2) NOT NULL DEFAULT 0,
  mismatch_flag TINYINT NOT NULL DEFAULT 0,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE org (
  id BIGINT NOT NULL PRIMARY KEY,
  org_code VARCHAR(64) NOT NULL,
  org_name VARCHAR(128) NOT NULL,
  org_type VARCHAR(32) NOT NULL,
  status TINYINT NOT NULL DEFAULT 1,
  contact_name VARCHAR(64) DEFAULT NULL,
  contact_phone VARCHAR(32) DEFAULT NULL,
  address VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE department (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  parent_id BIGINT DEFAULT NULL,
  dept_name VARCHAR(128) NOT NULL,
  dept_code VARCHAR(64) DEFAULT NULL,
  sort_no INT NOT NULL DEFAULT 0,
  status TINYINT NOT NULL DEFAULT 1,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE role (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  role_name VARCHAR(128) NOT NULL,
  role_code VARCHAR(64) NOT NULL,
  role_desc VARCHAR(255) DEFAULT NULL,
  status TINYINT NOT NULL DEFAULT 1,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE staff (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  department_id BIGINT NOT NULL,
  staff_no VARCHAR(64) NOT NULL,
  username VARCHAR(64) NOT NULL,
  password_hash VARCHAR(255) NOT NULL,
  real_name VARCHAR(64) NOT NULL,
  phone VARCHAR(32) DEFAULT NULL,
  email VARCHAR(128) DEFAULT NULL,
  gender TINYINT DEFAULT NULL,
  status TINYINT NOT NULL DEFAULT 1,
  last_login_time DATETIME DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE staff_role (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  staff_id BIGINT NOT NULL,
  role_id BIGINT NOT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE disease (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  disease_code VARCHAR(64) NOT NULL,
  disease_name VARCHAR(128) NOT NULL,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE elder_disease (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  elder_id BIGINT NOT NULL,
  disease_id BIGINT NOT NULL,
  diagnosed_date DATE DEFAULT NULL,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE product_tag (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  tag_code VARCHAR(64) NOT NULL,
  tag_name VARCHAR(128) NOT NULL,
  tag_type VARCHAR(32) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE disease_forbidden_tag (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  disease_id BIGINT NOT NULL,
  tag_id BIGINT NOT NULL,
  forbidden_level TINYINT NOT NULL DEFAULT 1,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE disease_forbidden_tag_audit (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  disease_id BIGINT NOT NULL,
  action_type VARCHAR(32) NOT NULL,
  before_tag_ids VARCHAR(512) DEFAULT NULL,
  after_tag_ids VARCHAR(512) DEFAULT NULL,
  operator_staff_id BIGINT DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE product (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  product_code VARCHAR(64) NOT NULL,
  product_name VARCHAR(128) NOT NULL,
  category VARCHAR(64) DEFAULT NULL,
  unit VARCHAR(16) DEFAULT NULL,
  price DECIMAL(10,2) NOT NULL DEFAULT 0,
  points_price INT NOT NULL DEFAULT 0,
  safety_stock INT NOT NULL DEFAULT 0,
  status TINYINT NOT NULL DEFAULT 1,
  tag_ids VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE `order` (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  order_no VARCHAR(64) NOT NULL,
  elder_id BIGINT NOT NULL,
  total_amount DECIMAL(10,2) NOT NULL DEFAULT 0,
  points_used INT NOT NULL DEFAULT 0,
  payable_amount DECIMAL(10,2) NOT NULL DEFAULT 0,
  pay_status TINYINT NOT NULL DEFAULT 0,
  pay_time DATETIME DEFAULT NULL,
  order_status TINYINT NOT NULL DEFAULT 1,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE order_item (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  order_id BIGINT NOT NULL,
  product_id BIGINT NOT NULL,
  product_name VARCHAR(128) NOT NULL,
  unit_price DECIMAL(10,2) NOT NULL DEFAULT 0,
  quantity INT NOT NULL DEFAULT 1,
  total_amount DECIMAL(10,2) NOT NULL DEFAULT 0,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE elder_points_account (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  elder_id BIGINT NOT NULL,
  points_balance INT NOT NULL DEFAULT 0,
  status TINYINT NOT NULL DEFAULT 1,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE points_log (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  elder_id BIGINT NOT NULL,
  change_type VARCHAR(32) NOT NULL,
  change_points INT NOT NULL,
  balance_after INT NOT NULL,
  ref_order_id BIGINT DEFAULT NULL,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE billing_config (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  config_key VARCHAR(64) NOT NULL,
  config_value DECIMAL(10,2) NOT NULL,
  effective_month CHAR(7) NOT NULL,
  status TINYINT NOT NULL DEFAULT 1,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE billing_care_level_fee (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  care_level VARCHAR(32) NOT NULL,
  fee_monthly DECIMAL(10,2) NOT NULL,
  effective_month CHAR(7) NOT NULL,
  status TINYINT NOT NULL DEFAULT 1,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE inventory_log (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  product_id BIGINT NOT NULL,
  batch_id BIGINT DEFAULT NULL,
  change_type VARCHAR(32) NOT NULL,
  change_qty INT NOT NULL,
  ref_order_id BIGINT DEFAULT NULL,
  ref_adjustment_id BIGINT DEFAULT NULL,
  remark VARCHAR(255) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE inventory_adjustment (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  product_id BIGINT NOT NULL,
  batch_id BIGINT DEFAULT NULL,
  adjust_type VARCHAR(32) NOT NULL,
  adjust_qty INT NOT NULL,
  reason VARCHAR(255) DEFAULT NULL,
  operator_staff_id BIGINT DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);

CREATE TABLE inventory_batch (
  id BIGINT NOT NULL PRIMARY KEY,
  org_id BIGINT NOT NULL,
  product_id BIGINT NOT NULL,
  batch_no VARCHAR(64) NOT NULL,
  quantity INT NOT NULL DEFAULT 0,
  cost_price DECIMAL(10,2) NOT NULL DEFAULT 0,
  expire_date DATE DEFAULT NULL,
  warehouse_location VARCHAR(64) DEFAULT NULL,
  create_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  update_time DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  is_deleted TINYINT NOT NULL DEFAULT 0
);
